import { CurrentResourceStrings } from '../../core/i18n/resources';
import { GridColumnDataType } from '../../data-operations/data-util';
import { PivotUtil } from './pivot-util';
// Equals to pretty much this configuration:
// {
//     member: () => 'All Periods',
//     enabled: true,
//     fieldName: 'AllPeriods',
//     childLevel: {
//         fieldName: 'Years',
//         member: (rec) => {
//             const recordValue = rec['Date'];
//             return recordValue ? (new Date(recordValue)).getFullYear().toString() : rec['Years'];
//         },
//         enabled: true,
//         childLevel: {
//                 member: (rec) => {
//                     const recordValue = rec['Date'];
//                     return recordValue ? new Date(recordValue).toLocaleString('default', { month: 'long' }) : rec['Months'];
//                 },
//                 enabled: true,
//                 fieldName: 'Months',
//                 childLevel: {
//                         member: 'Date',
//                         fieldName:'Date',
//                         enabled: true
//                     }
//             }
//     }
// },
export class IgxPivotDateDimension {
    /**
     * Gets/Sets the resource strings.
     *
     * @remarks
     * By default it uses EN resources.
     */
    set resourceStrings(value) {
        this._resourceStrings = Object.assign({}, this._resourceStrings, value);
    }
    get resourceStrings() {
        return this._resourceStrings;
    }
    /**
     * Gets/Sets the base dimension that is used by this class to determine the other dimensions and their values.
     * Having base dimension set is required in order for the Date Dimensions to show.
     */
    get baseDimension() {
        return this._baseDimension;
    }
    set baseDimension(value) {
        this._baseDimension = value;
        this.initialize(this.baseDimension, this.options);
    }
    /**
     * Gets/Sets the options for the predefined date dimensions whether to show quarter, years and etc.
     */
    get options() {
        return this._options;
    }
    set options(value) {
        this._options = value;
        if (this.baseDimension) {
            this.initialize(this.baseDimension, this.options);
        }
    }
    /**
     * @deprecated since version 15.1.x. Please use the new name `baseDimension` for future versions.
     *
     * Gets the base dimension that is used by this class to determine the other dimensions and their values.
     * Having base dimension set is required in order for the Date Dimensions to show.
     */
    get inBaseDimension() {
        return this._baseDimension;
    }
    /**
     * @deprecated since version 15.1.x. Please use the new name `options` for future versions.
     *
     * Gets the options for the predefined date dimensions whether to show quarter, years and etc.
     */
    get inOptions() {
        return this._options;
    }
    /**
     * Creates additional pivot date dimensions based on a provided dimension describing date data:
     *
     * @param inDateDimension Base dimension that is used by this class to determine the other dimensions and their values.
     * @param inOptions Options for the predefined date dimensions whether to show quarter, years and etc.
     * @example
     * ```typescript
     * // Displays only years as parent dimension to the base dimension provided.
     * new IgxPivotDateDimension({ memberName: 'Date', enabled: true }, { total: false, months: false });
     * ```
     */
    constructor(inBaseDimension, inOptions = {}) {
        /** Enables/Disables a particular dimension from pivot structure. */
        this.enabled = true;
        /** Default options. */
        this.defaultOptions = {
            total: true,
            years: true,
            months: true,
            fullDate: true
        };
        /** @hidden @internal */
        this.memberName = 'AllPeriods';
        this._resourceStrings = CurrentResourceStrings.GridResStrings;
        this._options = {};
        this._monthIntl = new Intl.DateTimeFormat('default', { month: 'long' });
        /** @hidden @internal */
        this.memberFunction = (_data) => this.resourceStrings.igx_grid_pivot_date_dimension_total;
        this._baseDimension = inBaseDimension;
        this._options = inOptions;
        if (this.baseDimension && this.options) {
            this.initialize(this.baseDimension, this.options);
        }
    }
    initialize(inBaseDimension, inOptions) {
        const options = { ...this.defaultOptions, ...inOptions };
        this.dataType = GridColumnDataType.Date;
        inBaseDimension.dataType = GridColumnDataType.Date;
        const baseDimension = options.fullDate ? inBaseDimension : null;
        const monthDimensionDef = {
            memberName: 'Months',
            memberFunction: (rec) => {
                const recordValue = PivotUtil.extractValueFromDimension(inBaseDimension, rec);
                return recordValue ? this._monthIntl.format(new Date(recordValue)) : rec['Months'];
            },
            enabled: true,
            childLevel: baseDimension
        };
        const monthDimension = options.months ? monthDimensionDef : baseDimension;
        const quarterDimensionDef = {
            memberName: 'Quarters',
            memberFunction: (rec) => {
                const recordValue = PivotUtil.extractValueFromDimension(inBaseDimension, rec);
                return recordValue ? `Q` + Math.ceil((new Date(recordValue).getMonth() + 1) / 3) : rec['Quarters'];
            },
            enabled: true,
            childLevel: monthDimension
        };
        const quarterDimension = options.quarters ? quarterDimensionDef : monthDimension;
        const yearsDimensionDef = {
            memberName: 'Years',
            memberFunction: (rec) => {
                const recordValue = PivotUtil.extractValueFromDimension(inBaseDimension, rec);
                return recordValue ? (new Date(recordValue)).getFullYear().toString() : rec['Years'];
            },
            enabled: true,
            childLevel: quarterDimension
        };
        const yearsDimension = options.years ? yearsDimensionDef : quarterDimension;
        this.childLevel = yearsDimension;
        if (!options.total) {
            this.memberName = yearsDimension.memberName;
            this.memberFunction = yearsDimension.memberFunction;
            this.childLevel = yearsDimension.childLevel;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGl2b3QtZ3JpZC1kaW1lbnNpb25zLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvaWduaXRldWktYW5ndWxhci9zcmMvbGliL2dyaWRzL3Bpdm90LWdyaWQvcGl2b3QtZ3JpZC1kaW1lbnNpb25zLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ25FLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBRXJFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFlekMsNENBQTRDO0FBQzVDLElBQUk7QUFDSixtQ0FBbUM7QUFDbkMscUJBQXFCO0FBQ3JCLCtCQUErQjtBQUMvQixvQkFBb0I7QUFDcEIsOEJBQThCO0FBQzlCLDZCQUE2QjtBQUM3QiwrQ0FBK0M7QUFDL0Msb0dBQW9HO0FBQ3BHLGFBQWE7QUFDYix5QkFBeUI7QUFDekIsd0JBQXdCO0FBQ3hCLHFDQUFxQztBQUNyQyx1REFBdUQ7QUFDdkQsK0hBQStIO0FBQy9ILHFCQUFxQjtBQUNyQixpQ0FBaUM7QUFDakMsdUNBQXVDO0FBQ3ZDLGdDQUFnQztBQUNoQywwQ0FBMEM7QUFDMUMsNENBQTRDO0FBQzVDLHdDQUF3QztBQUN4Qyx3QkFBd0I7QUFDeEIsZ0JBQWdCO0FBQ2hCLFFBQVE7QUFDUixLQUFLO0FBQ0wsTUFBTSxPQUFPLHFCQUFxQjtJQWlCOUI7Ozs7O09BS0c7SUFDSCxJQUFXLGVBQWUsQ0FBQyxLQUEyQjtRQUNsRCxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLGdCQUFnQixFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQzVFLENBQUM7SUFFRCxJQUFXLGVBQWU7UUFDdEIsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUM7SUFDakMsQ0FBQztJQUVEOzs7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VyxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUN6RixDQUFDO1lBQ0QsT0FBTyxFQUFFLElBQUk7WUFDYixVQUFVLEVBQUUsZ0JBQWdCO1NBQy9CLENBQUM7UUFDRixNQUFNLGNBQWMsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLENBQUM7UUFDNUUsSUFBSSxDQUFDLFVBQVUsR0FBRyxjQUFjLENBQUM7UUFFakMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUU7WUFDaEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxjQUFjLENBQUMsVUFBVSxDQUFDO1lBQzVDLElBQUksQ0FBQyxjQUFjLEdBQUcsY0FBYyxDQUFDLGNBQWMsQ0FBQztZQUNwRCxJQUFJLENBQUMsVUFBVSxHQUFHLGNBQWMsQ0FBQyxVQUFVLENBQUM7U0FDL0M7SUFDTCxDQUFDO0NBSUoiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJR3JpZFJlc291cmNlU3RyaW5ncyB9IGZyb20gJy4uLy4uL2NvcmUvaTE4bi9ncmlkLXJlc291cmNlcyc7XG5pbXBvcnQgeyBDdXJyZW50UmVzb3VyY2VTdHJpbmdzIH0gZnJvbSAnLi4vLi4vY29yZS9pMThuL3Jlc291cmNlcyc7XG5pbXBvcnQgeyBHcmlkQ29sdW1uRGF0YVR5cGUgfSBmcm9tICcuLi8uLi9kYXRhLW9wZXJhdGlvbnMvZGF0YS11dGlsJztcbmltcG9ydCB7IElQaXZvdERpbWVuc2lvbiB9IGZyb20gJy4vcGl2b3QtZ3JpZC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUGl2b3RVdGlsIH0gZnJvbSAnLi9waXZvdC11dGlsJztcblxuZXhwb3J0IGludGVyZmFjZSBJUGl2b3REYXRlRGltZW5zaW9uT3B0aW9ucyB7XG4gICAgLyoqIEVuYWJsZXMvRGlzYWJsZXMgdG90YWwgdmFsdWUgb2YgYWxsIHBlcmlvZHMuICovXG4gICAgdG90YWw/OiBib29sZWFuO1xuICAgIC8qKiBFbmFibGVzL0Rpc2FibGVzIGRpbWVuc2lvbnMgcGVyIHllYXIgZnJvbSBwcm92aWRlZCBwZXJpb2RzLiAqL1xuICAgIHllYXJzPzogYm9vbGVhbjtcbiAgICAvKi8qKiBFbmFibGVzL0Rpc2FibGVzIGRpbWVuc2lvbnMgcGVyIHF1YXJ0ZXIgZnJvbSBwcm92aWRlZCBwZXJpb2RzLiAqL1xuICAgIHF1YXJ0ZXJzPzogYm9vbGVhbjtcbiAgICAvKiogRW5hYmxlcy9EaXNhYmxlcyBkaW1lbnNpb25zIHBlciBtb250aCBmcm9tIHByb3ZpZGVkIHBlcmlvZHMuICovXG4gICAgbW9udGhzPzogYm9vbGVhbjtcbiAgICAvKiogRW5hYmxlZC9EaXNhYmxlcyBkaW1lbnNpb25zIGZvciB0aGUgZnVsbCBkYXRlIHByb3ZpZGVkICovXG4gICAgZnVsbERhdGU/OiBib29sZWFuO1xufVxuXG4vLyBFcXVhbHMgdG8gcHJldHR5IG11Y2ggdGhpcyBjb25maWd1cmF0aW9uOlxuLy8ge1xuLy8gICAgIG1lbWJlcjogKCkgPT4gJ0FsbCBQZXJpb2RzJyxcbi8vICAgICBlbmFibGVkOiB0cnVlLFxuLy8gICAgIGZpZWxkTmFtZTogJ0FsbFBlcmlvZHMnLFxuLy8gICAgIGNoaWxkTGV2ZWw6IHtcbi8vICAgICAgICAgZmllbGROYW1lOiAnWWVhcnMnLFxuLy8gICAgICAgICBtZW1iZXI6IChyZWMpID0+IHtcbi8vICAgICAgICAgICAgIGNvbnN0IHJlY29yZFZhbHVlID0gcmVjWydEYXRlJ107XG4vLyAgICAgICAgICAgICByZXR1cm4gcmVjb3JkVmFsdWUgPyAobmV3IERhdGUocmVjb3JkVmFsdWUpKS5nZXRGdWxsWWVhcigpLnRvU3RyaW5nKCkgOiByZWNbJ1llYXJzJ107XG4vLyAgICAgICAgIH0sXG4vLyAgICAgICAgIGVuYWJsZWQ6IHRydWUsXG4vLyAgICAgICAgIGNoaWxkTGV2ZWw6IHtcbi8vICAgICAgICAgICAgICAgICBtZW1iZXI6IChyZWMpID0+IHtcbi8vICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVjb3JkVmFsdWUgPSByZWNbJ0RhdGUnXTtcbi8vICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlY29yZFZhbHVlID8gbmV3IERhdGUocmVjb3JkVmFsdWUpLnRvTG9jYWxlU3RyaW5nKCdkZWZhdWx0JywgeyBtb250aDogJ2xvbmcnIH0pIDogcmVjWydNb250aHMnXTtcbi8vICAgICAgICAgICAgICAgICB9LFxuLy8gICAgICAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsXG4vLyAgICAgICAgICAgICAgICAgZmllbGROYW1lOiAnTW9udGhzJyxcbi8vICAgICAgICAgICAgICAgICBjaGlsZExldmVsOiB7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICBtZW1iZXI6ICdEYXRlJyxcbi8vICAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkTmFtZTonRGF0ZScsXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICBlbmFibGVkOiB0cnVlXG4vLyAgICAgICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgIH1cbi8vICAgICB9XG4vLyB9LFxuZXhwb3J0IGNsYXNzIElneFBpdm90RGF0ZURpbWVuc2lvbiBpbXBsZW1lbnRzIElQaXZvdERpbWVuc2lvbiB7XG4gICAgLyoqIEVuYWJsZXMvRGlzYWJsZXMgYSBwYXJ0aWN1bGFyIGRpbWVuc2lvbiBmcm9tIHBpdm90IHN0cnVjdHVyZS4gKi9cbiAgICBwdWJsaWMgZW5hYmxlZCA9IHRydWU7XG5cbiAgICAvKipcbiAgICAgKiBHZXRzL1NldHMgZGF0YSB0eXBlXG4gICAgICovXG4gICAgcHVibGljIGRhdGFUeXBlPzogR3JpZENvbHVtbkRhdGFUeXBlO1xuXG4gICAgLyoqIERlZmF1bHQgb3B0aW9ucy4gKi9cbiAgICBwdWJsaWMgZGVmYXVsdE9wdGlvbnMgPSB7XG4gICAgICAgIHRvdGFsOiB0cnVlLFxuICAgICAgICB5ZWFyczogdHJ1ZSxcbiAgICAgICAgbW9udGhzOiB0cnVlLFxuICAgICAgICBmdWxsRGF0ZTogdHJ1ZVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBHZXRzL1NldHMgdGhlIHJlc291cmNlIHN0cmluZ3MuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIEJ5IGRlZmF1bHQgaXQgdXNlcyBFTiByZXNvdXJjZXMuXG4gICAgICovXG4gICAgcHVibGljIHNldCByZXNvdXJjZVN0cmluZ3ModmFsdWU6IElHcmlkUmVzb3VyY2VTdHJpbmdzKSB7XG4gICAgICAgIHRoaXMuX3Jlc291cmNlU3RyaW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuX3Jlc291cmNlU3RyaW5ncywgdmFsdWUpO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgcmVzb3VyY2VTdHJpbmdzKCk6IElHcmlkUmVzb3VyY2VTdHJpbmdzIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Jlc291cmNlU3RyaW5ncztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzL1NldHMgdGhlIGJhc2UgZGltZW5zaW9uIHRoYXQgaXMgdXNlZCBieSB0aGlzIGNsYXNzIHRvIGRldGVybWluZSB0aGUgb3RoZXIgZGltZW5zaW9ucyBhbmQgdGhlaXIgdmFsdWVzLlxuICAgICAqIEhhdmluZyBiYXNlIGRpbWVuc2lvbiBzZXQgaXMgcmVxdWlyZWQgaW4gb3JkZXIgZm9yIHRoZSBEYXRlIERpbWVuc2lvbnMgdG8gc2hvdy5cbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0IGJhc2VEaW1lbnNpb24oKTogSVBpdm90RGltZW5zaW9uIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Jhc2VEaW1lbnNpb247XG4gICAgfVxuICAgIHB1YmxpYyBzZXQgYmFzZURpbWVuc2lvbih2YWx1ZTogSVBpdm90RGltZW5zaW9uKSB7XG4gICAgICAgIHRoaXMuX2Jhc2VEaW1lbnNpb24gPSB2YWx1ZTtcbiAgICAgICAgdGhpcy5pbml0aWFsaXplKHRoaXMuYmFzZURpbWVuc2lvbiwgdGhpcy5vcHRpb25zKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXRzL1NldHMgdGhlIG9wdGlvbnMgZm9yIHRoZSBwcmVkZWZpbmVkIGRhdGUgZGltZW5zaW9ucyB3aGV0aGVyIHRvIHNob3cgcXVhcnRlciwgeWVhcnMgYW5kIGV0Yy5cbiAgICAgKi9cbiAgICBwdWJsaWMgZ2V0IG9wdGlvbnMoKTogSVBpdm90RGF0ZURpbWVuc2lvbk9wdGlvbnMge1xuICAgICAgICByZXR1cm4gdGhpcy5fb3B0aW9ucztcbiAgICB9XG4gICAgcHVibGljIHNldCBvcHRpb25zKHZhbHVlOiBJUGl2b3REYXRlRGltZW5zaW9uT3B0aW9ucykge1xuICAgICAgICB0aGlzLl9vcHRpb25zID0gdmFsdWU7XG4gICAgICAgIGlmICh0aGlzLmJhc2VEaW1lbnNpb24pIHtcbiAgICAgICAgICAgIHRoaXMuaW5pdGlhbGl6ZSh0aGlzLmJhc2VEaW1lbnNpb24sIHRoaXMub3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAZGVwcmVjYXRlZCBzaW5jZSB2ZXJzaW9uIDE1LjEueC4gUGxlYXNlIHVzZSB0aGUgbmV3IG5hbWUgYGJhc2VEaW1lbnNpb25gIGZvciBmdXR1cmUgdmVyc2lvbnMuXG4gICAgICpcbiAgICAgKiBHZXRzIHRoZSBiYXNlIGRpbWVuc2lvbiB0aGF0IGlzIHVzZWQgYnkgdGhpcyBjbGFzcyB0byBkZXRlcm1pbmUgdGhlIG90aGVyIGRpbWVuc2lvbnMgYW5kIHRoZWlyIHZhbHVlcy5cbiAgICAgKiBIYXZpbmcgYmFzZSBkaW1lbnNpb24gc2V0IGlzIHJlcXVpcmVkIGluIG9yZGVyIGZvciB0aGUgRGF0ZSBEaW1lbnNpb25zIHRvIHNob3cuXG4gICAgICovXG4gICAgcHVibGljIGdldCBpbkJhc2VEaW1lbnNpb24oKTogSVBpdm90RGltZW5zaW9uIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Jhc2VEaW1lbnNpb247XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQGRlcHJlY2F0ZWQgc2luY2UgdmVyc2lvbiAxNS4xLnguIFBsZWFzZSB1c2UgdGhlIG5ldyBuYW1lIGBvcHRpb25zYCBmb3IgZnV0dXJlIHZlcnNpb25zLlxuICAgICAqXG4gICAgICogR2V0cyB0aGUgb3B0aW9ucyBmb3IgdGhlIHByZWRlZmluZWQgZGF0ZSBkaW1lbnNpb25zIHdoZXRoZXIgdG8gc2hvdyBxdWFydGVyLCB5ZWFycyBhbmQgZXRjLlxuICAgICAqL1xuICAgIHB1YmxpYyBnZXQgaW5PcHRpb25zKCk6IElQaXZvdERhdGVEaW1lbnNpb25PcHRpb25zIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX29wdGlvbnM7XG4gICAgfVxuXG4gICAgLyoqIEBoaWRkZW4gQGludGVybmFsICovXG4gICAgcHVibGljIGNoaWxkTGV2ZWw/OiBJUGl2b3REaW1lbnNpb247XG4gICAgLyoqIEBoaWRkZW4gQGludGVybmFsICovXG4gICAgcHVibGljIG1lbWJlck5hbWUgPSAnQWxsUGVyaW9kcyc7XG4gICAgcHJpdmF0ZSBfcmVzb3VyY2VTdHJpbmdzID0gQ3VycmVudFJlc291cmNlU3RyaW5ncy5HcmlkUmVzU3RyaW5ncztcbiAgICBwcml2YXRlIF9iYXNlRGltZW5zaW9uOiBJUGl2b3REaW1lbnNpb247XG4gICAgcHJpdmF0ZSBfb3B0aW9uczogSVBpdm90RGF0ZURpbWVuc2lvbk9wdGlvbnMgPSB7fTtcbiAgICBwcml2YXRlIF9tb250aEludGwgPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdCgnZGVmYXVsdCcsIHsgbW9udGg6ICdsb25nJyB9KTtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYWRkaXRpb25hbCBwaXZvdCBkYXRlIGRpbWVuc2lvbnMgYmFzZWQgb24gYSBwcm92aWRlZCBkaW1lbnNpb24gZGVzY3JpYmluZyBkYXRlIGRhdGE6XG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5EYXRlRGltZW5zaW9uIEJhc2UgZGltZW5zaW9uIHRoYXQgaXMgdXNlZCBieSB0aGlzIGNsYXNzIHRvIGRldGVybWluZSB0aGUgb3RoZXIgZGltZW5zaW9ucyBhbmQgdGhlaXIgdmFsdWVzLlxuICAgICAqIEBwYXJhbSBpbk9wdGlvbnMgT3B0aW9ucyBmb3IgdGhlIHByZWRlZmluZWQgZGF0ZSBkaW1lbnNpb25zIHdoZXRoZXIgdG8gc2hvdyBxdWFydGVyLCB5ZWFycyBhbmQgZXRjLlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIC8vIERpc3BsYXlzIG9ubHkgeWVhcnMgYXMgcGFyZW50IGRpbWVuc2lvbiB0byB0aGUgYmFzZSBkaW1lbnNpb24gcHJvdmlkZWQuXG4gICAgICogbmV3IElneFBpdm90RGF0ZURpbWVuc2lvbih7IG1lbWJlck5hbWU6ICdEYXRlJywgZW5hYmxlZDogdHJ1ZSB9LCB7IHRvdGFsOiBmYWxzZSwgbW9udGhzOiBmYWxzZSB9KTtcbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihpbkJhc2VEaW1lbnNpb246IElQaXZvdERpbWVuc2lvbiwgaW5PcHRpb25zOiBJUGl2b3REYXRlRGltZW5zaW9uT3B0aW9ucyA9IHt9KSB7XG4gICAgICAgIHRoaXMuX2Jhc2VEaW1lbnNpb24gPSBpbkJhc2VEaW1lbnNpb247XG4gICAgICAgIHRoaXMuX29wdGlvbnMgPSBpbk9wdGlvbnM7XG4gICAgICAgIGlmICh0aGlzLmJhc2VEaW1lbnNpb24gJiYgdGhpcy5vcHRpb25zKSB7XG4gICAgICAgICAgICB0aGlzLmluaXRpYWxpemUodGhpcy5iYXNlRGltZW5zaW9uLCB0aGlzLm9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGluaXRpYWxpemUoaW5CYXNlRGltZW5zaW9uLCBpbk9wdGlvbnMpIHtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHsgLi4udGhpcy5kZWZhdWx0T3B0aW9ucywgLi4uaW5PcHRpb25zIH07XG5cbiAgICAgICAgdGhpcy5kYXRhVHlwZSA9IEdyaWRDb2x1bW5EYXRhVHlwZS5EYXRlO1xuICAgICAgICBpbkJhc2VEaW1lbnNpb24uZGF0YVR5cGUgPSBHcmlkQ29sdW1uRGF0YVR5cGUuRGF0ZTtcblxuICAgICAgICBjb25zdCBiYXNlRGltZW5zaW9uID0gb3B0aW9ucy5mdWxsRGF0ZSA/IGluQmFzZURpbWVuc2lvbiA6IG51bGw7XG4gICAgICAgIGNvbnN0IG1vbnRoRGltZW5zaW9uRGVmOiBJUGl2b3REaW1lbnNpb24gPSB7XG4gICAgICAgICAgICBtZW1iZXJOYW1lOiAnTW9udGhzJyxcbiAgICAgICAgICAgIG1lbWJlckZ1bmN0aW9uOiAocmVjKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVjb3JkVmFsdWUgPSBQaXZvdFV0aWwuZXh0cmFjdFZhbHVlRnJvbURpbWVuc2lvbihpbkJhc2VEaW1lbnNpb24sIHJlYyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlY29yZFZhbHVlID8gdGhpcy5fbW9udGhJbnRsLmZvcm1hdChuZXcgRGF0ZShyZWNvcmRWYWx1ZSkpIDogcmVjWydNb250aHMnXTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICAgICAgY2hpbGRMZXZlbDogYmFzZURpbWVuc2lvblxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBtb250aERpbWVuc2lvbiA9IG9wdGlvbnMubW9udGhzID8gbW9udGhEaW1lbnNpb25EZWYgOiBiYXNlRGltZW5zaW9uO1xuXG4gICAgICAgIGNvbnN0IHF1YXJ0ZXJEaW1lbnNpb25EZWY6IElQaXZvdERpbWVuc2lvbiA9IHtcbiAgICAgICAgICAgIG1lbWJlck5hbWU6ICdRdWFydGVycycsXG4gICAgICAgICAgICBtZW1iZXJGdW5jdGlvbjogKHJlYykgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlY29yZFZhbHVlID0gUGl2b3RVdGlsLmV4dHJhY3RWYWx1ZUZyb21EaW1lbnNpb24oaW5CYXNlRGltZW5zaW9uLCByZWMpO1xuICAgICAgICAgICAgICAgIHJldHVybiByZWNvcmRWYWx1ZSA/IGBRYCArIE1hdGguY2VpbCgobmV3IERhdGUocmVjb3JkVmFsdWUpLmdldE1vbnRoKCkgKyAxKSAvIDMpIDogcmVjWydRdWFydGVycyddO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgICBjaGlsZExldmVsOiBtb250aERpbWVuc2lvblxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBxdWFydGVyRGltZW5zaW9uID0gb3B0aW9ucy5xdWFydGVycyA/IHF1YXJ0ZXJEaW1lbnNpb25EZWYgOiBtb250aERpbWVuc2lvbjtcblxuICAgICAgICBjb25zdCB5ZWFyc0RpbWVuc2lvbkRlZjogSVBpdm90RGltZW5zaW9uID0ge1xuICAgICAgICAgICAgbWVtYmVyTmFtZTogJ1llYXJzJyxcbiAgICAgICAgICAgIG1lbWJlckZ1bmN0aW9uOiAocmVjKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVjb3JkVmFsdWUgPSBQaXZvdFV0aWwuZXh0cmFjdFZhbHVlRnJvbURpbWVuc2lvbihpbkJhc2VEaW1lbnNpb24sIHJlYyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlY29yZFZhbHVlID8gKG5ldyBEYXRlKHJlY29yZFZhbHVlKSkuZ2V0RnVsbFllYXIoKS50b1N0cmluZygpIDogcmVjWydZZWFycyddO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgICAgICBjaGlsZExldmVsOiBxdWFydGVyRGltZW5zaW9uXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHllYXJzRGltZW5zaW9uID0gb3B0aW9ucy55ZWFycyA/IHllYXJzRGltZW5zaW9uRGVmIDogcXVhcnRlckRpbWVuc2lvbjtcbiAgICAgICAgdGhpcy5jaGlsZExldmVsID0geWVhcnNEaW1lbnNpb247XG5cbiAgICAgICAgaWYgKCFvcHRpb25zLnRvdGFsKSB7XG4gICAgICAgICAgICB0aGlzLm1lbWJlck5hbWUgPSB5ZWFyc0RpbWVuc2lvbi5tZW1iZXJOYW1lO1xuICAgICAgICAgICAgdGhpcy5tZW1iZXJGdW5jdGlvbiA9IHllYXJzRGltZW5zaW9uLm1lbWJlckZ1bmN0aW9uO1xuICAgICAgICAgICAgdGhpcy5jaGlsZExldmVsID0geWVhcnNEaW1lbnNpb24uY2hpbGRMZXZlbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKiBAaGlkZGVuIEBpbnRlcm5hbCAqL1xuICAgIHB1YmxpYyBtZW1iZXJGdW5jdGlvbiA9IChfZGF0YSkgPT4gdGhpcy5yZXNvdXJjZVN0cmluZ3MuaWd4X2dyaWRfcGl2b3RfZGF0ZV9kaW1lbnNpb25fdG90YWw7XG59XG4iXX0=